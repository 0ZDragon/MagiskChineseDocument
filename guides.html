<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>开发人员指南 | Magisk 中文文档</title>
    <meta name="description" content="Magisk 中文文档，由 Jesse205 手动机翻。">
    <link rel="preload stylesheet" href="/MagiskChineseDocument/assets/style.00def0d3.css" as="style">
    <link rel="modulepreload" href="/MagiskChineseDocument/assets/app.2dc519f0.js">
    <link rel="modulepreload" href="/MagiskChineseDocument/assets/guides.md.55308c2b.lean.js">
    
    <link rel="icon" href="/MagiskChineseDocument/favicon.ico" sizes="any">
  <link rel="apple-touch-icon" href="/MagiskChineseDocument/apple-touch-icon.png">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-e91e23b1><!--[--><!--]--><!--[--><span tabindex="-1" data-v-f637ee78></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-f637ee78> Skip to content </a><!--]--><!----><header class="VPNav" data-v-e91e23b1 data-v-86afb924><div class="VPNavBar has-sidebar" data-v-86afb924 data-v-7a5a363d><div class="container" data-v-7a5a363d><div class="VPNavBarTitle has-sidebar" data-v-7a5a363d data-v-aaed7263><a class="title" href="/MagiskChineseDocument/" data-v-aaed7263><!--[--><!--]--><!--[--><img class="VPImage logo" src="/MagiskChineseDocument/favicon.ico" alt data-v-dc109a54><!--]--><!--[-->Magisk 中文文档<!--]--><!--[--><!--]--></a></div><div class="content" data-v-7a5a363d><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-7a5a363d data-v-d8cdd395><span id="main-nav-aria-label" class="visually-hidden" data-v-d8cdd395>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://github.com/topjohnwu/Magisk" target="_blank" rel="noreferrer" data-v-d8cdd395 data-v-08b6ef03 data-v-97a44ddd><!--[-->官方仓库<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://topjohnwu.github.io/Magisk/" target="_blank" rel="noreferrer" data-v-d8cdd395 data-v-08b6ef03 data-v-97a44ddd><!--[-->官方文档<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-7a5a363d data-v-d70ebc80><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-d70ebc80 data-v-9a8716a3 data-v-3258a739><span class="check" data-v-3258a739><span class="icon" data-v-3258a739><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-9a8716a3><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-9a8716a3><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-7a5a363d data-v-6a2a6555 data-v-b8f6762d><!--[--><a class="VPSocialLink" href="https://gitee.com/Jesse205/magisk-chinese-document" target="_blank" rel="noopener" data-v-b8f6762d data-v-179ad0ea><svg role="img" t="1672577881896" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1932" width="128" height="128"><path d="M512 1024C229.222 1024 0 794.778 0 512S229.222 0 512 0s512 229.222 512 512-229.222 512-512 512z m259.149-568.883h-290.74a25.293 25.293 0 0 0-25.292 25.293l-0.026 63.206c0 13.952 11.315 25.293 25.267 25.293h177.024c13.978 0 25.293 11.315 25.293 25.267v12.646a75.853 75.853 0 0 1-75.853 75.853h-240.23a25.293 25.293 0 0 1-25.267-25.293V417.203a75.853 75.853 0 0 1 75.827-75.853h353.946a25.293 25.293 0 0 0 25.267-25.292l0.077-63.207a25.293 25.293 0 0 0-25.268-25.293H417.152a189.62 189.62 0 0 0-189.62 189.645V771.15c0 13.977 11.316 25.293 25.294 25.293h372.94a170.65 170.65 0 0 0 170.65-170.65V480.384a25.293 25.293 0 0 0-25.293-25.267z" p-id="1933"></path></svg></a><a class="VPSocialLink" href="https://github.com/Jesse205/MagiskChineseDocument" target="_blank" rel="noopener" data-v-b8f6762d data-v-179ad0ea><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-7a5a363d data-v-b390db70 data-v-aeb1c475><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-aeb1c475><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-aeb1c475><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-aeb1c475><div class="VPMenu" data-v-aeb1c475 data-v-079aa243><!----><!--[--><!--[--><!----><div class="group" data-v-b390db70><div class="item appearance" data-v-b390db70><p class="label" data-v-b390db70>Appearance</p><div class="appearance-action" data-v-b390db70><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-b390db70 data-v-9a8716a3 data-v-3258a739><span class="check" data-v-3258a739><span class="icon" data-v-3258a739><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-9a8716a3><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-9a8716a3><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-b390db70><div class="item social-links" data-v-b390db70><div class="VPSocialLinks social-links-list" data-v-b390db70 data-v-b8f6762d><!--[--><a class="VPSocialLink" href="https://gitee.com/Jesse205/magisk-chinese-document" target="_blank" rel="noopener" data-v-b8f6762d data-v-179ad0ea><svg role="img" t="1672577881896" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1932" width="128" height="128"><path d="M512 1024C229.222 1024 0 794.778 0 512S229.222 0 512 0s512 229.222 512 512-229.222 512-512 512z m259.149-568.883h-290.74a25.293 25.293 0 0 0-25.292 25.293l-0.026 63.206c0 13.952 11.315 25.293 25.267 25.293h177.024c13.978 0 25.293 11.315 25.293 25.267v12.646a75.853 75.853 0 0 1-75.853 75.853h-240.23a25.293 25.293 0 0 1-25.267-25.293V417.203a75.853 75.853 0 0 1 75.827-75.853h353.946a25.293 25.293 0 0 0 25.267-25.292l0.077-63.207a25.293 25.293 0 0 0-25.268-25.293H417.152a189.62 189.62 0 0 0-189.62 189.645V771.15c0 13.977 11.316 25.293 25.294 25.293h372.94a170.65 170.65 0 0 0 170.65-170.65V480.384a25.293 25.293 0 0 0-25.293-25.267z" p-id="1933"></path></svg></a><a class="VPSocialLink" href="https://github.com/Jesse205/MagiskChineseDocument" target="_blank" rel="noopener" data-v-b8f6762d data-v-179ad0ea><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-7a5a363d data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-e91e23b1 data-v-72f15439><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-72f15439><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-72f15439><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-72f15439>Menu</span></button><a class="top-link" href="#" data-v-72f15439> Return to top </a></div><aside class="VPSidebar" data-v-e91e23b1 data-v-240a42a7><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-240a42a7><span class="visually-hidden" id="sidebar-aria-label" data-v-240a42a7> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>面向普通用户</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/MagiskChineseDocument/install.html" style="padding-left:0px;" tabindex="-1" data-v-e49051b6 data-v-97a44ddd><!--[--><span class="link-text" data-v-e49051b6>安装说明</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/MagiskChineseDocument/faq.html" style="padding-left:0px;" tabindex="-1" data-v-e49051b6 data-v-97a44ddd><!--[--><span class="link-text" data-v-e49051b6>常见问题</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/MagiskChineseDocument/releases/index.html" style="padding-left:0px;" tabindex="-1" data-v-e49051b6 data-v-97a44ddd><!--[--><span class="link-text" data-v-e49051b6>发布日志</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/MagiskChineseDocument/changes.html" style="padding-left:0px;" tabindex="-1" data-v-e49051b6 data-v-97a44ddd><!--[--><span class="link-text" data-v-e49051b6>Magisk  更新日志</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>面向开发人员</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link active" href="/MagiskChineseDocument/guides.html" style="padding-left:0px;" tabindex="-1" data-v-e49051b6 data-v-97a44ddd><!--[--><span class="link-text" data-v-e49051b6>开发人员指南</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/MagiskChineseDocument/tools.html" style="padding-left:0px;" tabindex="-1" data-v-e49051b6 data-v-97a44ddd><!--[--><span class="link-text" data-v-e49051b6>Magisk 工具</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/MagiskChineseDocument/details.html" style="padding-left:0px;" tabindex="-1" data-v-e49051b6 data-v-97a44ddd><!--[--><span class="link-text" data-v-e49051b6>内部细节</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/MagiskChineseDocument/boot.html" style="padding-left:0px;" tabindex="-1" data-v-e49051b6 data-v-97a44ddd><!--[--><span class="link-text" data-v-e49051b6>Android 引导诡计</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-e91e23b1 data-v-d9661cd3><div class="VPDoc has-sidebar has-aside" data-v-d9661cd3 data-v-6b6fcb79><div class="container" data-v-6b6fcb79><div class="aside" data-v-6b6fcb79><div class="aside-curtain" data-v-6b6fcb79></div><div class="aside-container" data-v-6b6fcb79><div class="aside-content" data-v-6b6fcb79><div class="VPDocAside" data-v-6b6fcb79 data-v-c8158c08><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-c8158c08 data-v-1c535019><div class="content" data-v-1c535019><div class="outline-marker" data-v-1c535019></div><div class="outline-title" data-v-1c535019>本页内容</div><nav aria-labelledby="doc-outline-aria-label" data-v-1c535019><span class="visually-hidden" id="doc-outline-aria-label" data-v-1c535019> Table of Contents for current page </span><ul class="root" data-v-1c535019 data-v-f1f7b818><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-c8158c08></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b6fcb79><div class="content-container" data-v-6b6fcb79><!--[--><!--]--><main class="main" data-v-6b6fcb79><div style="position:relative;" class="vp-doc _MagiskChineseDocument_guides" data-v-6b6fcb79><div><h1 id="开发人员指南" tabindex="-1">开发人员指南 <a class="header-anchor" href="#开发人员指南" aria-hidden="true">#</a></h1><h2 id="busybox" tabindex="-1">BusyBox <a class="header-anchor" href="#busybox" aria-hidden="true">#</a></h2><p>Magisk 附带了一个完整的 BusyBox 二进制（包括完整的 SELinux 支持）。可执行文件位于 <code>/data/adb/magisk/busybox</code> 。Magisk 的 BusyBox 支持运行时可切换的“ASH独立外壳模式”。这种独立模式的意思是，当在 BusyBox 的 <code>ash</code> shell 中运行时，无论设置为 <code>PATH</code> ，每个命令都将直接使用 BusyBox 中的 applet。例如，像 <code>ls</code>、<code>rm</code>、<code>chmod</code> 这样的命令将<strong>不使用</strong> <code>PATH</code> 中的内容（在 Android 的情况下，默认情况下将分别为 <code>/system/bin/ls</code> 、<code>/system/bin/rm</code> 和 <code>/system/bin/chmod</code> ），而是直接调用内部 BusyBox 小程序。这确保脚本始终在可预测的环境中运行，并且无论在哪个 Android 版本上运行，都始终具有完整的命令集。要强制命令<em>不使用</em>BusyBox，必须使用完整路径调用可执行文件。</p><p>在 Magisk 上下文中运行的每个 shell 脚本都将在启用独立模式（Standalone Mode）的 BusyBox 的 <code>ash</code> shell 中执行。对于与第三方开发人员相关的内容，这包括所有启动脚本和模块安装脚本。</p><p>对于想在 Magisk 之外使用“独立模式”功能的开发者，有两种方法可以启用它：</p><ol><li>将环境变量 <code>ASH_STANDALONE</code> 设置为 <code>1</code><br>示例：<code>ASH_STANDALONE=1 /data/adb/magisk/busybox sh &lt;script&gt;</code></li><li>使用命令行选项切换：<br><code>/data/adb/magisk/busybox sh -o standalone &lt;script&gt;</code></li></ol><p>为了确保所有后续执行的 <code>sh</code> shell 也以独立模式运行，选项1是首选方法（这是 Magisk 和 Magisk app 内部使用的方法），因为环境变量向下继承到子进程。</p><h2 id="magisk-模块" tabindex="-1">Magisk 模块 <a class="header-anchor" href="#magisk-模块" aria-hidden="true">#</a></h2><p>Magisk 模块是放置在 <code>/data/adb/modules</code> 中的文件夹，结构如下：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">/data/adb/modules</span></span>
<span class="line"><span style="color:#A6ACCD;">├── .</span></span>
<span class="line"><span style="color:#A6ACCD;">├── .</span></span>
<span class="line"><span style="color:#A6ACCD;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">├── $MODID                  &lt;--- 文件夹以模块的 ID 命名</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │      *** 模块标识 ***</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── module.prop         &lt;--- 此文件存储模块的元数据（metadata）</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │      *** 主要内容 ***</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── system              &lt;--- 如果 skip_mount 不存在，将装入此文件夹</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   ├── ...</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   ├── ...</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   └── ...</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── zygisk              &lt;--- 此文件夹包含模块的 Zygisk native 库</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   ├── arm64-v8a.so</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   ├── armeabi-v7a.so</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   ├── x86.so</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   ├── x86_64.so</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   └── unloaded        &lt;--- 如果存在，则 native 库不兼容</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │      *** 状态标志 ***</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── skip_mount          &lt;--- 如果存在，Magisk 将不会装载您的系统文件夹</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── disable             &lt;--- 如果存在，模块将被禁用</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── remove              &lt;--- 如果存在，模块将在下次重新启动时删除</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │      *** 可选文件 ***</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── post-fs-data.sh     &lt;--- 此脚本将在 post-fs-data 中执行</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── service.sh          &lt;--- 此脚本将在 late_start 服务中执行</span></span>
<span class="line"><span style="color:#A6ACCD;">|   ├── uninstall.sh        &lt;--- 当 Magisk 删除您的模块时，将执行此脚本</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── system.prop         &lt;--- resetprop 将此文件中的属性作为系统属性加载</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── sepolicy.rule       &lt;--- 其他自定义 sepolicy 规则</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │      *** 自动生成，请勿手动创建或修改 ***</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── vendor              &lt;--- $MODID/system/vendor 的符号链接</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── product             &lt;--- $MODID/system/product 的符号链接</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── system_ext          &lt;--- $MODID/system/system_ext 的符号链接</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │      *** 允许任何其他文件/文件夹 ***</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── ...</span></span>
<span class="line"><span style="color:#A6ACCD;">│   └── ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">├── 其他模块</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── .</span></span>
<span class="line"><span style="color:#A6ACCD;">│   └── .</span></span>
<span class="line"><span style="color:#A6ACCD;">├── .</span></span>
<span class="line"><span style="color:#A6ACCD;">├── .</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h4 id="module-prop" tabindex="-1">module.prop <a class="header-anchor" href="#module-prop" aria-hidden="true">#</a></h4><p>这是 <code>module.prop</code> <strong>必须遵守的</strong>格式</p><p>（以下代码块虽然标注为 js，但实际上是 prop，此操作仅为提供代码高亮）</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#FFCB6B;">字符串</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">string</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">name=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">字符串</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">string</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">version=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">字符串</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">string</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">versionCode=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">整数</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">int</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">author=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">字符串</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">string</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">description=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">字符串</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">string</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">updateJson=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">链接</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> (可选)</span></span>
<span class="line"></span></code></pre></div><ul><li><code>id</code> 必须匹配此正则表达式：<code>^[a-zA-Z][a-zA-Z0-9._-]+$</code>（也就是开头必须为字母，后面为字母、数字、点 <code>.</code> 、下划线 <code>_</code> 和减号 <code>-</code>）<br> 示例: <code>a_module</code> <span class="VPBadge tip" data-v-ce917cfb><!--[-->✓<!--]--></span>、<code>a.module</code> <span class="VPBadge tip" data-v-ce917cfb><!--[-->✓<!--]--></span>、<code>module-101</code> <span class="VPBadge tip" data-v-ce917cfb><!--[-->✓<!--]--></span>、<code>a module</code> <span class="VPBadge danger" data-v-ce917cfb><!--[-->✗<!--]--></span>、<code>1_module</code> <span class="VPBadge danger" data-v-ce917cfb><!--[-->✗<!--]--></span>、<code>-a-module</code> <span class="VPBadge danger" data-v-ce917cfb><!--[-->✗<!--]--></span><br> 这是模块的<strong>唯一标识符</strong>。模块发布后，您不应更改它。</li><li><code>versionCode </code>必须是<strong>整数</strong>。这用于对比版本，以便检查更新。</li><li><code>updateJson</code> 应该指向一个 URL，该 URL 下载 JSON 以提供信息，以便 Magisk app 可以更新模块。</li><li>上面没有提到的其他字符串可以是任何<strong>单行</strong>字符串。</li><li>确保使用 <code>UNIX (LF)</code> 换行类型，而不是 <code>Windows (CR+LF)</code> 或 <code>Macintosh (CR)</code>。</li></ul><p>更新的JSON的格式：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">versionCode</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> int</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">zipUrl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> url</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">changelog</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> url</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="shell-脚本-sh" tabindex="-1">Shell 脚本 (<code>*.sh</code>) <a class="header-anchor" href="#shell-脚本-sh" aria-hidden="true">#</a></h4><p>请阅读 <a href="#boot-scripts">Boot Scripts</a> 部分，了解 <code>post-fs-data.sh</code> 和 <code>service.sh</code> 之间的区别。对于大多数模块开发人员来说，如果您只需要运行引导脚本，<code>service.sh</code> 应该足够好了。</p><p>在模块的所有脚本中，请使用 <code>MODDIR=${0%/*}</code> 获取模块的基本目录路径；<strong>不要</strong>在脚本中硬编码模块路径。<br> 如果启用了Zygisk，则环境变量 <code>ZYGISK_ENABLED</code> 将设置为 <code>1</code> 。</p><h4 id="system-文件夹" tabindex="-1"><code>system</code> 文件夹 <a class="header-anchor" href="#system-文件夹" aria-hidden="true">#</a></h4><p>要替换/注入的所有文件都应放在此文件夹中。此文件夹将以递归方式合并到真正的 <code>/system</code> 中，也就是说：真实 <code>/system</code> 中的现有文件将被模块 <code>system</code> 中的文件替换，模块 <code>system</code> 中的新文件将被添加到真实 <code>/system</code> 中。</p><p>如果您将名为 <code>.replace</code> 的文件放在任何文件夹中，而不是合并其内容，则该文件夹将直接替换实际系统中的文件夹。这对于交换整个文件夹非常方便。</p><p>如果要替换 <code>/vendor</code> 、<code>/product</code> 或 <code>/system_ext</code> 中的文件，请分别将它们放在 <code>system/vendor</code> 、<code>system/product</code> 和 <code>system/system_ext</code> 下。Magisk 将透明地处理这些分区是否位于单独的分区中。</p><h4 id="zygisk" tabindex="-1">Zygisk <a class="header-anchor" href="#zygisk" aria-hidden="true">#</a></h4><p>Zygisk 是 Magisk 的一项功能，它允许高级模块开发人员在每个 Android 应用程序的进程中直接运行代码，然后再进行专业化和运行。有关 Zygisk API 和构建 Zygisk 模块的更多详细信息，请查看 <a href="https://github.com/topjohnwu/zygisk-module-sample" target="_blank" rel="noreferrer">Zygisk 模块示例</a> 项目。</p><h4 id="system-prop" tabindex="-1">system.prop <a class="header-anchor" href="#system-prop" aria-hidden="true">#</a></h4><p>此文件遵循与 <code>build.prop</code> 相同的格式。每行由 <code>[键 key]=[值 value]</code>组成。</p><h4 id="sepolicy-rule" tabindex="-1">sepolicy.rule <a class="header-anchor" href="#sepolicy-rule" aria-hidden="true">#</a></h4><p>如果您的模块需要一些额外的 sepolicy 补丁，请将这些规则添加到此文件中。此文件中的每一行都将被视为策略语句。有关如何格式化策略语句的更多详细信息，请查看 <a href="./tools.html#magiskpolicy">magiskpolicy</a> 的文档。</p><h2 id="magisk-模块安装程序" tabindex="-1">Magisk 模块安装程序 <a class="header-anchor" href="#magisk-模块安装程序" aria-hidden="true">#</a></h2><p>Magisk 模块安装程序是打包在 zip 文件中的 Magisk 模块，可以在 Magisk 应用程序或第三方recovery（如 TWRP）中刷入。最简单的 Magisk 模块安装程序只是一个打包为 zip 文件的 Magisk 模块，此外还有以下文件：</p><ul><li><code>update-binary</code>：下载最新的 <a href="https://github.com/topjohnwu/Magisk/blob/master/scripts/module_installer.sh" target="_blank" rel="noreferrer">module_installer.sh</a> 并将该脚本重命名/复制为 <code>update-binary</code></li><li><code>updater-script</code>：这个文件应该只包含字符串 <code>#MAGISK</code></li></ul><p>模块安装程序脚本将会设置环境，将模块文件从 zip 文件提取到正确的位置，然后完成安装过程，这对于大多数简单的 Magisk 模块来说应该足够好了。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">模块module.zip</span></span>
<span class="line"><span style="color:#A6ACCD;">│</span></span>
<span class="line"><span style="color:#A6ACCD;">├── META-INF</span></span>
<span class="line"><span style="color:#A6ACCD;">│   └── com</span></span>
<span class="line"><span style="color:#A6ACCD;">│       └── google</span></span>
<span class="line"><span style="color:#A6ACCD;">│           └── android</span></span>
<span class="line"><span style="color:#A6ACCD;">│               ├── update-binary      &lt;--- 您下载 module_installer.sh</span></span>
<span class="line"><span style="color:#A6ACCD;">│               └── updater-script     &lt;--- 应仅包含字符串“#MAGISK”</span></span>
<span class="line"><span style="color:#A6ACCD;">│</span></span>
<span class="line"><span style="color:#A6ACCD;">├── customize.sh                       &lt;--- （可选，稍后将详细介绍）</span></span>
<span class="line"><span style="color:#A6ACCD;">│                                           此脚本将来源于 update-binary</span></span>
<span class="line"><span style="color:#A6ACCD;">├── ...</span></span>
<span class="line"><span style="color:#A6ACCD;">├── ...  /* 模块的其余文件 */</span></span>
<span class="line"><span style="color:#A6ACCD;">│</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h4 id="定制" tabindex="-1">定制 <a class="header-anchor" href="#定制" aria-hidden="true">#</a></h4><p>If you need to customize the module installation process, optionally you can create a script in the installer named <code>customize.sh</code>. This script will be <em>sourced</em> (not executed!) by the module installer script after all files are extracted and default permissions and secontext are applied. This is very useful if your module require additional setup based on the device ABI, or you need to set special permissions/secontext for some of your module files.</p><p>If you would like to fully control and customize the installation process, declare <code>SKIPUNZIP=1</code> in <code>customize.sh</code> to skip all default installation steps. By doing so, your <code>customize.sh</code> will be responsible to install everything by itself.</p><p>The <code>customize.sh</code> script runs in Magisk&#39;s BusyBox <code>ash</code> shell with &quot;Standalone Mode&quot; enabled. The following variables and functions are available:</p><h5 id="variables" tabindex="-1">Variables <a class="header-anchor" href="#variables" aria-hidden="true">#</a></h5><ul><li><code>MAGISK_VER</code> (string): the version string of current installed Magisk (e.g. <code>v20.0</code>)</li><li><code>MAGISK_VER_CODE</code> (int): the version code of current installed Magisk (e.g. <code>20000</code>)</li><li><code>BOOTMODE</code> (bool): <code>true</code> if the module is being installed in the Magisk app</li><li><code>MODPATH</code> (path): the path where your module files should be installed</li><li><code>TMPDIR</code> (path): a place where you can temporarily store files</li><li><code>ZIPFILE</code> (path): your module&#39;s installation zip</li><li><code>ARCH</code> (string): the CPU architecture of the device. Value is either <code>arm</code>, <code>arm64</code>, <code>x86</code>, or <code>x64</code></li><li><code>IS64BIT</code> (bool): <code>true</code> if <code>$ARCH</code> is either <code>arm64</code> or <code>x64</code></li><li><code>API</code> (int): the API level (Android version) of the device (e.g. <code>21</code> for Android 5.0)</li></ul><h5 id="functions" tabindex="-1">Functions <a class="header-anchor" href="#functions" aria-hidden="true">#</a></h5><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">ui_print &lt;msg&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    print &lt;msg&gt; to console</span></span>
<span class="line"><span style="color:#A6ACCD;">    Avoid using &#39;echo&#39; as it will not display in custom recovery&#39;s console</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">abort &lt;msg&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    print error message &lt;msg&gt; to console and terminate the installation</span></span>
<span class="line"><span style="color:#A6ACCD;">    Avoid using &#39;exit&#39; as it will skip the termination cleanup steps</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">set_perm &lt;target&gt; &lt;owner&gt; &lt;group&gt; &lt;permission&gt; [context]</span></span>
<span class="line"><span style="color:#A6ACCD;">    if [context] is not set, the default is &quot;u:object_r:system_file:s0&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    this function is a shorthand for the following commands:</span></span>
<span class="line"><span style="color:#A6ACCD;">       chown owner.group target</span></span>
<span class="line"><span style="color:#A6ACCD;">       chmod permission target</span></span>
<span class="line"><span style="color:#A6ACCD;">       chcon context target</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">set_perm_recursive &lt;directory&gt; &lt;owner&gt; &lt;group&gt; &lt;dirpermission&gt; &lt;filepermission&gt; [context]</span></span>
<span class="line"><span style="color:#A6ACCD;">    if [context] is not set, the default is &quot;u:object_r:system_file:s0&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    for all files in &lt;directory&gt;, it will call:</span></span>
<span class="line"><span style="color:#A6ACCD;">       set_perm file owner group filepermission context</span></span>
<span class="line"><span style="color:#A6ACCD;">    for all directories in &lt;directory&gt; (including itself), it will call:</span></span>
<span class="line"><span style="color:#A6ACCD;">       set_perm dir owner group dirpermission context</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>For convenience, you can also declare a list of folders you want to replace in the variable name <code>REPLACE</code>. The module installer script will create the <code>.replace</code> file into the folders listed in <code>REPLACE</code>. For example:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">REPLACE=&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">/system/app/YouTube</span></span>
<span class="line"><span style="color:#A6ACCD;">/system/app/Bloatware</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>The list above will result in the following files being created: <code>$MODPATH/system/app/YouTube/.replace</code> and <code>$MODPATH/system/app/Bloatware/.replace</code>.</p><h4 id="notes" tabindex="-1">Notes <a class="header-anchor" href="#notes" aria-hidden="true">#</a></h4><ul><li>When your module is downloaded with the Magisk app, <code>update-binary</code> will be <strong>forcefully</strong> replaced with the latest <a href="https://github.com/topjohnwu/Magisk/blob/master/scripts/module_installer.sh" target="_blank" rel="noreferrer"><code>module_installer.sh</code></a>. <strong>DO NOT</strong> try to add any custom logic in <code>update-binary</code>.</li><li>Due to historical reasons, <strong>DO NOT</strong> add a file named <code>install.sh</code> in your module installer zip.</li><li><strong>DO NOT</strong> call <code>exit</code> at the end of <code>customize.sh</code>. The module installer script has to perform some cleanups before exiting.</li></ul><h2 id="boot-scripts" tabindex="-1">Boot Scripts <a class="header-anchor" href="#boot-scripts" aria-hidden="true">#</a></h2><p>In Magisk, you can run boot scripts in 2 different modes: <strong>post-fs-data</strong> and <strong>late_start service</strong> mode.</p><ul><li>post-fs-data mode <ul><li>This stage is BLOCKING. The boot process is paused before execution is done, or 10 seconds have passed.</li><li>Scripts run before any modules are mounted. This allows a module developer to dynamically adjust their modules before it gets mounted.</li><li>This stage happens before Zygote is started, which pretty much means everything in Android</li><li><strong>WARNING:</strong> using <code>setprop</code> will deadlock the boot process! Please use <code>resetprop -n &lt;prop_name&gt; &lt;prop_value&gt;</code> instead.</li><li><strong>Only run scripts in this mode if necessary.</strong></li></ul></li><li>late_start service mode <ul><li>This stage is NON-BLOCKING. Your script runs in parallel with the rest of the booting process.</li><li><strong>This is the recommended stage to run most scripts.</strong></li></ul></li></ul><p>In Magisk, there are also 2 kinds of scripts: <strong>general scripts</strong> and <strong>module scripts</strong>.</p><ul><li>General Scripts <ul><li>Placed in <code>/data/adb/post-fs-data.d</code> or <code>/data/adb/service.d</code></li><li>Only executed if the script is set as executable (<code>chmod +x script.sh</code>)</li><li>Scripts in <code>post-fs-data.d</code> runs in post-fs-data mode, and scripts in <code>service.d</code> runs in late_start service mode.</li><li>Modules should <strong>NOT</strong> add general scripts during installation</li></ul></li><li>Module Scripts <ul><li>Placed in the module&#39;s own folder</li><li>Only executed if the module is enabled</li><li><code>post-fs-data.sh</code> runs in post-fs-data mode, and <code>service.sh</code> runs in late_start service mode.</li></ul></li></ul><p>All boot scripts will run in Magisk&#39;s BusyBox <code>ash</code> shell with &quot;Standalone Mode&quot; enabled.</p><h2 id="root-directory-overlay-system" tabindex="-1">Root Directory Overlay System <a class="header-anchor" href="#root-directory-overlay-system" aria-hidden="true">#</a></h2><p>Since <code>/</code> is read-only on system-as-root devices, Magisk provides an overlay system to enable developers to replace files in rootdir or add new <code>*.rc</code> scripts. This feature is designed mostly for custom kernel developers.</p><p>Overlay files shall be placed in the <code>overlay.d</code> folder in boot image ramdisk, and they follow these rules:</p><ol><li>All <code>*.rc</code> files in <code>overlay.d</code> will be read and concatenated <strong>AFTER</strong> <code>init.rc</code></li><li>Existing files can be replaced by files located at the same relative path</li><li>Files that correspond to a non-existing file will be ignored</li></ol><p>To add additional files which you can refer to in your custom <code>*.rc</code> scripts, add them into <code>overlay.d/sbin</code>. The 3 rules above do not apply to anything in this folder; instead, they will be directly copied to Magisk&#39;s internal <code>tmpfs</code> directory (which used to always be <code>/sbin</code>).</p><p>Starting from Android 11, the <code>/sbin</code> folder may no longer exists, and in that scenario, Magisk randomly generates a different <code>tmpfs</code> folder each boot. Every occurrence of the pattern <code>${MAGISKTMP}</code> in your <code>*.rc</code> scripts will be replaced with the Magisk <code>tmpfs</code> folder when <code>magiskinit</code> injects it into <code>init.rc</code>. On pre Android 11 devices, <code>${MAGISKTMP}</code> will simply be replaced with <code>/sbin</code>, so <strong>NEVER</strong> hardcode <code>/sbin</code> in the <code>*.rc</code> scripts when referencing these additional files.</p><p>Here is an example of how to setup <code>overlay.d</code> with a custom <code>*.rc</code> script:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">ramdisk</span></span>
<span class="line"><span style="color:#A6ACCD;">│</span></span>
<span class="line"><span style="color:#A6ACCD;">├── overlay.d</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── sbin</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   ├── libfoo.ko      &lt;--- These 2 files will be copied</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   └── myscript.sh    &lt;--- into Magisk&#39;s tmpfs directory</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── custom.rc          &lt;--- This file will be injected into init.rc</span></span>
<span class="line"><span style="color:#A6ACCD;">│   ├── res</span></span>
<span class="line"><span style="color:#A6ACCD;">│   │   └── random.png     &lt;--- This file will replace /res/random.png</span></span>
<span class="line"><span style="color:#A6ACCD;">│   └── new_file           &lt;--- This file will be ignored because</span></span>
<span class="line"><span style="color:#A6ACCD;">│                               /new_file does not exist</span></span>
<span class="line"><span style="color:#A6ACCD;">├── res</span></span>
<span class="line"><span style="color:#A6ACCD;">│   └── random.png         &lt;--- This file will be replaced by</span></span>
<span class="line"><span style="color:#A6ACCD;">│                               /overlay.d/res/random.png</span></span>
<span class="line"><span style="color:#A6ACCD;">├── ...</span></span>
<span class="line"><span style="color:#A6ACCD;">├── ...  /* The rest of initramfs files */</span></span>
<span class="line"><span style="color:#A6ACCD;">│</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Here is an example of the <code>custom.rc</code>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;"># Use ${MAGISKTMP} to refer to Magisk&#39;s tmpfs directory</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">on early-init</span></span>
<span class="line"><span style="color:#A6ACCD;">    setprop sys.example.foo bar</span></span>
<span class="line"><span style="color:#A6ACCD;">    insmod ${MAGISKTMP}/libfoo.ko</span></span>
<span class="line"><span style="color:#A6ACCD;">    start myservice</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">service myservice ${MAGISKTMP}/myscript.sh</span></span>
<span class="line"><span style="color:#A6ACCD;">    oneshot</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="参考链接" tabindex="-1">参考链接 <a class="header-anchor" href="#参考链接" aria-hidden="true">#</a></h2><p><a href="https://topjohnwu.github.io/Magisk/guides.html" target="_blank" rel="noreferrer">Magisk Developer Guides</a></p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-6b6fcb79 data-v-ae0105da><div class="edit-info" data-v-ae0105da><div class="edit-link" data-v-ae0105da><a class="VPLink link edit-link-button" href="https://gitee.com/Jesse205/magisk-chinese-document/edit/master/guides.md" target="_blank" rel="noreferrer" data-v-ae0105da data-v-97a44ddd><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" data-v-ae0105da><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 在 Gitee 上编辑此页面<!--]--><!----></a></div><div class="last-updated" data-v-ae0105da><p class="VPLastUpdated" data-v-ae0105da data-v-a299be59>更新时间: <time datetime="2023-01-06T17:13:25.000Z" data-v-a299be59></time></p></div></div><div class="prev-next" data-v-ae0105da><div class="pager" data-v-ae0105da><a class="pager-link prev" href="/MagiskChineseDocument/changes.html" data-v-ae0105da><span class="desc" data-v-ae0105da>上一篇</span><span class="title" data-v-ae0105da>Magisk  更新日志</span></a></div><div class="has-prev pager" data-v-ae0105da><a class="pager-link next" href="/MagiskChineseDocument/tools.html" data-v-ae0105da><span class="desc" data-v-ae0105da>下一篇</span><span class="title" data-v-ae0105da>Magisk 工具</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-e91e23b1 data-v-13fad65a><div class="container" data-v-13fad65a><p class="message" data-v-13fad65a>原始文档版本：2022年11月16日</p><!----></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"app_changes.md\":\"df445667\",\"readme.md\":\"cd496a2e\",\"changes.md\":\"60e62c17\",\"boot.md\":\"6b5fa9a9\",\"index.md\":\"3b704807\",\"releases_18100.md\":\"3e5c4073\",\"details.md\":\"b62c685c\",\"faq.md\":\"1b75274b\",\"releases_22100.md\":\"2465c813\",\"releases_24100.md\":\"190e135d\",\"releases_24200.md\":\"30a33186\",\"releases_24300.md\":\"cb189f19\",\"releases_25000.md\":\"7c36faba\",\"releases_25100.md\":\"3e804042\",\"releases_25200.md\":\"7391b77f\",\"releases_24000.md\":\"8caa7f8e\",\"guides.md\":\"55308c2b\",\"releases_23000.md\":\"31c23fc2\",\"install.md\":\"df591c90\",\"ota.md\":\"0fa7a3b4\",\"releases_18000.md\":\"fcf11fd3\",\"releases_19300.md\":\"c05bd8c6\",\"releases_19000.md\":\"9c2b8fd4\",\"releases_19200.md\":\"6c5e4b26\",\"releases_20000.md\":\"7efac378\",\"releases_19400.md\":\"c4082035\",\"releases_20100.md\":\"ffe8a846\",\"releases_index.md\":\"84058ff9\",\"tools.md\":\"eec95afd\",\"releases_19100.md\":\"8827332d\",\"releases_21100.md\":\"6427279b\",\"releases_22000.md\":\"92c2311f\",\"releases_20300.md\":\"56e3a7d8\",\"releases_20400.md\":\"01082a92\",\"releases_21200.md\":\"44c2128b\",\"releases_21400.md\":\"34c1943d\",\"releases_20200.md\":\"fedd8774\",\"releases_21000.md\":\"82b0d5d6\"}")</script>
    <script type="module" async src="/MagiskChineseDocument/assets/app.2dc519f0.js"></script>
    
  </body>
</html>